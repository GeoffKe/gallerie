<!DOCTYPE html>
<html>
<head>
<script src="http://code.jquery.com/jquery-1.9.1.min.js"></script>
<script src="jquery.gallerie.js"></script>
<link rel="stylesheet" type="text/css" href="gallerie.css"/>

<script type="text/javascript">
$(document).ready(function(){

	// fetch images from flickr
	$.ajax('http://api.flickr.com/services/rest/',{
		data: {
			format: 'json',
			method: 'flickr.interestingness.getList',
			api_key: '270e736b0e42643aab5aab7819164d84'
		},
		dataType: 'jsonp',
		jsonp: 'jsoncallback'
	}).done(function(data){
	
		var $gallerie = $('#gallery'),
			$image,
			$link,
			base_url,
			t_url,
			i_url;
		
		// create img elements for each image from flickr
		$.each(data.photos.photo, function(index, photo){
			base_url = 'http://farm' + photo.farm + '.static.flickr.com/' + photo.server + '/' + photo.id + '_' + photo.secret;
			// t_url = thumbnail, i_url = big image
			t_url = base_url + '_m.jpg';
			i_url = base_url + '_b.jpg';  
			
			// create img element using thumbnail
			$image = $('<img class="thumbnail-image"/>').prop({
				'src': t_url,
				'title': photo.title
			});
			
			// wrap the thumbnail in link that points to big image
			$link = $('<a class="thumbnail-wrapper"/>').prop('href', i_url).append($image);
			$gallerie.append($link);
		});
		
		
		// fancy preview component that scales image on hover
		var previewScale = 1.4;
		$gallerie.on('mouseenter', '.thumbnail-image', function(event){
			var $thumbnail = $(this),
				offset = $thumbnail.offset(),
				width = $thumbnail.width(),
				height = $thumbnail.height(),
				prevWidth = width*previewScale,
				prevHeight = height*previewScale,
				$preview = $thumbnail.clone().css({
					position: 'absolute',
					left: offset.left,
					top: offset.top
				}).addClass('thumbnail-scrollover');
		
			$('body').append($thumbnail.closest('a').clone().append($preview));
		
			$preview.animate({
				width: prevWidth,
				height: prevHeight,
				left: offset.left - (prevWidth-width)/2,
				top: offset.top - (prevHeight-height)/2
			}, 500, function(){
				// remove any leftover scrollover objects
				// that could linger because of browser scrolling issues
				$('body').find('.thumbnail-scrollover').not($preview).each(function(index){
					// if it is not animating then it is stuck and we remove it
					if ($(this).queue().length == 0)
						$(this).remove();
				});
			}).on('mouseleave', function(event){
				var $scrollover = $(this);
				$thumbnail.finish();
				$scrollover.animate({
					width: width,
					height: height,
					left: offset.left,
					top: offset.top
				}, 250, function(event){
					$scrollover.remove();
				});
			});
		});
	
		// user gallerie to create a gallery and open to image #18
		$('#gallery').gallerie({})
			.gallerie('open')
			.gallerie('setImage', 18);
		
		/*
			Detect click event on our special preview element and launch
			the gallerie overlay when it is clicked, opening the link 
			that the preview was associated with
		*/
		$(document).on('click', '.thumbnail-scrollover', function(event){
			var link = $(this).find('a:first')[0];
			$gallerie.gallerie('open', link);
		});
	});
});

</script>

<style>
	body {
		background-color: black;
	}
	
	#gallery {
		margin-left: auto;
		margin-right: auto;
	}
</style>
</head>

<body>
<div id="gallery"></div>
</body>
</html>
